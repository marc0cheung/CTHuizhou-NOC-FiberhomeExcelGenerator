# 《华为例维表格生成工具》使用说明

## 第一部分：软件简介

该软件针对华为网管系统导出的数据表格：当前性能数据.xlsx和用户可编辑的模板表格HWops_template.xlsx ，实现复杂数据的自动检索、计算和归纳，生成两个例维所需的分表格（genHWOPS.xls和genHWOMS.xls）。让用户可从繁琐的数据归档工作中解脱出来，方便查看光缆线路具体情况，提高例维的效率。

该软件的开发环境为：Python 3.7.8 + Windows 10 专业版 x64 + PyCharm Community 2020.2.3（Build #PC-202.7660.27, built on October 6, 2020，Runtime version: 11.0.8+10-b944.34 amd64）

> 该使用说明采用 Typora 基于 Markdown 语言编写，需要编辑请**事先安装 Typora 编辑器**，再使用 Typora 打开 README.md 文件，方可得到优美的格式渲染。



## 第二部分：软件界面介绍

本软件仅有一个窗口作为主界面，窗口上方显示文本，为软件简介和作者信息。另有一个命令提示符，进行程序运行的提示输出。主界面下设五个功能按钮，具体对应功能如下：

- **Generate Huawei OMS Sheet：**利用 "当前性能数据.xlsx" 生成 “华为波分OMS检查（每月）” 表格
- **Generate Huawei OPS Sheet：**利用 "当前性能数据.xlsx" 生成 “华为波分OPS检查（每月）” 表格
- **Generate! ：**一次性生成两个表格
- **Exit：**退出本软件

![image-20210813141644707](C:\Users\Marco\AppData\Roaming\Typora\typora-user-images\image-20210813141644707.png)



## 第三部分：软件功能函数介绍

本软件共计```genOMS()```、```genOPS()``` 两个主要函数，分别对应两个表格的生成。```wholeProcess()```函数对应实现 “Generate!” 按钮对应的一键生成功能。



#### genOMS()

**功能简介：**利用 “当前性能数据.xlsx” 生成 genNewOSC.xlsx，即为 “华为波分OPS检查（每月）” 表格。

**函数原理：** 首先对网管系统所导出的数据表格 “当前性能数据.xls” 所对应的 DataFrame 进行化简，减少遍历次数。在OMS表格中，我们需要的是 “总功率输入” 或者 “总功率输出”， 因此，我们将原表 B 列中，凡是含有 “激光器” 的行，都删去。

经过观察发现，在化简后的表格中，目标表格中所需要的成组的线路会自动排列在一起，即华为网管系统会成组成组地输出数据。因此，直接将这些化简后的线路直接写入新表中，再按照其B列中的输入/输出情况，对合并了的单元格进行填写。

最后，由于 VOA 数值是需要人工核验的，无需程序生成，但为了方便人工核验，在生成目标表格后，再对 VOA 栏进行两两合并单元格，减少人工操作。

这样，就完成了 OMS 表格（genHWOMS.xls）的生成。



#### genOPS()

**功能简介：**利用 “当前性能数据.xlsx” 和 HWops_template.xlsx 生成 genHWOPS.xlsx，即为 “华为波分OPS检查（每月）” 表格。

**函数原理：**首先利用 pandas 读入 当前性能数据.xlsx 原始表格作为原始数据输入，保存进 ```hw_Ori``` 变量中；再利用 pandas 读入 HWops_template.xlsx 作为模板表格，保存进 ```HWops_template``` 变量中。

经过观察发现，在 OPS 表格中，我们只取用激光器的输入输出功率，对于总功率是不取用的。因此，为了化简原始数据，减少遍历次数，提高运行效率，利用 pandas 提供的 drop 函数对原始数据表格B列中不含有 “激光器” 进行删除，并重置索引，避免出现无法遍历的情况。

由于 Pandas 无法处理合并单元格，会在合并单元格的非首行处写入大量 nan 值，因此使用 ```ffill()``` 函数，取前值进行填充，使合并单元格能正常分配到对应的每一行中。

与烽火网管相比，华为网管的OPS表格就显得非常简洁，AB两地的结点名也足够简单。因此，依照烽火网管自动生成器的代码思路，其检索策略是：

- 对于输出光功率，如果A结点名匹配 + B结点所提取的方向信息在原始数据表的那一行中，且B列是包含 “激光器” 与 “输出” 的，则认定为原始数据表格中的该行与模板表中的那一行匹配，则将原始表格中该行携带的数据填入模板表对应的位置中。
- 对于输入光功率，则利用B结点名匹配 + A结点所提取方向信息在原始数据表的那一行，且B列的该行包含 “激光器” 和 “输入”，则将该行的数据写入模板表的对应位置中

写入输入/输出光功率完毕后，只需要多次遍历表格，就可以完成 A-B差异 、实际与理论衰耗差值、双纤衰耗差值、检修判断等内容进行输出并合并需要合并的单元格。

这样，就完成了 “华为波分OPS检查（每月）” 表格的生成。



## 第四部分 使用注意事项和潜在Bug

- 该软件仅可在64位的 Windows 操作系统下运行，若需在其它系统或32位系统下运行，或者对代码有修改的，需要在对应环境下重新打包编译，或配置好Python环境后直接在Python IDE中运行代码。

- 当前性能数据.xlsx 和 HWops_template.xlsx 必须与软件本身在同一个目录下，必须保持该二表格文件名一致，软件所生成的两个表格也会放在与软件所在位置相同的目录下。

- 对于 “当前性能数据.xlsx”，请保持表格的标题栏在第八行（即保持华为网管导出时的原样，不要做任何修改）

- 填写 HWops_template.xlsx 模板表格时，要确保理论每公里衰耗值、理论光路长度、理论衰耗都有数据，避免出现意料之外的问题。

- > **该软件仅为一个自动化辅助工具，未经大量数据用例的稳定性测试，由于现实中网管系统生成数据情况众多且复杂，代码的复用性可能会下降，因此，在发现数据异常的情况下，必须进行人工修正确认，避免出现维护事故。**



## 第五部分 软件依赖库说明

```python
# -*- coding:utf-8 -*-
__author__ = "Marco Cheung"
import re, sys, time
import pandas
import xlrd, xlwt
from PySide2 import QtCore, QtWidgets
from xlutils.copy import copy
from pyautogui import alert
```

